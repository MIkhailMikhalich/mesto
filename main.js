(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}const e=function(){function e(t,n,o,r,i,c,u){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t.name,this._img=t.link,this._id=t._id,this._likes,this._likers=t.likes,this._owner,this._user=n,this._template=c,this._api=u,this._handleLikeClick=o,this._handleCardClick=r,this._handleDeleteClick=i,null==t.owner?this._owner=n:this._owner=t.owner._id,null==t.likes?this._likes=0:this._likes=t.likes.length}var n,o;return n=e,(o=[{key:"updateLikes",value:function(t){t.textContent=this._likes}},{key:"likeCard",value:function(t){var e=this;this._api.putLike(this._id).then((function(n){e._likes=n.likes.length,e.updateLikes(t)})).catch((function(t){console.log(t)}))}},{key:"unLikeCard",value:function(t){var e=this;this._api.unPutLike(this._id).then((function(n){e._likes=n.likes.length,e.updateLikes(t)})).catch((function(t){console.log(t)}))}},{key:"_getTemplate",value:function(){return this._template.content.querySelector(".photocards__item").cloneNode(!0)}},{key:"createCard",value:function(){var t=this;this._element=this._getTemplate();var e=this._element.querySelector(".photocards__like-button"),n=this._element.querySelector(".photocards__photo-button"),o=this._element.querySelector(".photocards__delete-button"),r=this._element.querySelector(".photocards__place-name"),i=this._element.querySelector(".photocards__photo"),c=this._element.querySelector(".photocards__likes");return c.textContent=this._likes,r.textContent=this._name,i.src=this._img,i.alt="Фото ".concat(this._name),this._likers.forEach((function(n){n._id==t._user&&e.classList.toggle("photocards__likeimg-fill")})),this._user==this._owner?(o.classList.add("photocards__delete-button__visible"),o.addEventListener("click",(function(e){t._handleDeleteClick(t._id,e.currentTarget)}))):o.setAttribute("disabled",!0),n.addEventListener("click",(function(){t._handleCardClick(t._img,t._name)})),e.addEventListener("click",(function(e){t._handleLikeClick(e.currentTarget,c,t)})),this._element}}])&&t(n.prototype,o),e}(),n={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inputInvalidClass:"popup__input-invalid",buttonInvalidClass:"popup__save-button_disabled"};function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var r=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._form=e,this._config=n,this.inputList=this._form.querySelectorAll(this._config.inputSelector),this.saveButton=this._form.querySelector(this._config.submitButtonSelector)}var e,n;return e=t,(n=[{key:"_showErr",value:function(t){this._form.querySelector("#".concat(t.id,"-error")).textContent=t.validationMessage,t.classList.add(this._config.inputInvalidClass)}},{key:"_hideErr",value:function(t){this._form.querySelector("#".concat(t.id,"-error")).textContent="",t.classList.remove(this._config.inputInvalidClass)}},{key:"_checkValidity",value:function(t){t.validity.valid?this._hideErr(t):this._showErr(t)}},{key:"_setButtonState",value:function(t,e,n){e?(t.classList.remove(n.buttonInvalidClass),t.disabled=!1):(t.classList.add(n.buttonInvalidClass),t.disabled=!0)}},{key:"_setEvents",value:function(){var t=this;this.inputList.forEach((function(e){e.addEventListener("input",(function(n){t._checkValidity(e),t._setButtonState(t.saveButton,t._form.checkValidity(),t._config)}))}))}},{key:"resetValidation",value:function(){var t=this;this.inputList.forEach((function(e){t._form.querySelector("#".concat(e.id,"-error")).textContent="",e.classList.remove(t._config.inputInvalidClass)})),this._setButtonState(this.saveButton,this._form.checkValidity(),this._config)}},{key:"enableValidate",value:function(){this._setEvents(),this._setButtonState(this.saveButton,this._form._checkValidity,this._config)}}])&&o(e.prototype,n),t}();function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var c=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._popup=e,this.close=this.close.bind(this),this.setEventListeners=this.setEventListeners.bind(this),this._closeByESC=this._closeByESC.bind(this),this._closebutton=this._popup.querySelector(".button_close"),this._overlay=this._popup.querySelector(".popup__overlay")}var e,n;return e=t,(n=[{key:"open",value:function(){this._popup.classList.add("popup_visible"),document.addEventListener("keydown",this._closeByESC)}},{key:"close",value:function(){this._popup.classList.remove("popup_visible"),document.removeEventListener("keydown",this._closeByESC)}},{key:"_closeByESC",value:function(t){"Escape"===t.key&&this.close()}},{key:"setEventListeners",value:function(){var t=this;this._closebutton.addEventListener("click",(function(){t.close()})),this._overlay.addEventListener("click",(function(){t.close()}))}}])&&i(e.prototype,n),t}();function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function a(t,e,n){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=h(t)););return t}(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(t,e){return!e||"object"!==u(e)&&"function"!=typeof e?p(t):e}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var _=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(c,t);var e,n,o,r,i=(o=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=h(o);if(r){var n=h(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return f(this,t)});function c(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(n=i.call(this,t))._popup=t,n._handleFormSubmit=e,n._form=n._popup.querySelector(".popup__form"),n._getInputValues=n._getInputValues.bind(p(n)),n._inputList=n._form.querySelectorAll(".popup__input"),n.submitButton=n._popup.querySelector(".popup__save-button"),n._formValues={},n.setEventListeners=n.setEventListeners.bind(p(n)),n}return e=c,(n=[{key:"_getInputValues",value:function(){var t=this;return this._inputList,this._inputList.forEach((function(e){return t._formValues[e.name]=e.value})),this._formValues}},{key:"_resetInput",value:function(){this._inputList,this._inputList.forEach((function(t){return t.value=""}))}},{key:"setEventListeners",value:function(){var t=this;this._form.addEventListener("submit",(function(e){e.preventDefault(),t._handleFormSubmit(t._getInputValues()),t._resetInput(),t.submitButton.textContent="Сохранить..."})),a(h(c.prototype),"setEventListeners",this).call(this)}}])&&s(e.prototype,n),c}(c);function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function y(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function v(t,e,n){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=g(t)););return t}(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function m(t,e){return(m=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function b(t,e){return!e||"object"!==d(e)&&"function"!=typeof e?k(t):e}function k(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var S=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&m(t,e)}(c,t);var e,n,o,r,i=(o=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=g(o);if(r){var n=g(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return b(this,t)});function c(t,e,n){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(o=i.call(this,t))._popup=t,o._photonode=e,o._name=n,o.open=o.open.bind(k(o)),o}return e=c,(n=[{key:"open",value:function(t,e){v(g(c.prototype),"open",this).call(this),this._photonode.setAttribute("src","".concat(t)),this._photonode.setAttribute("alt","Фото ".concat(e)),this._name.textContent=e}}])&&y(e.prototype,n),c}(c);function E(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var w=function(){function t(e,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=e,this._info=n,this._avatar=o}var e,n;return e=t,(n=[{key:"getUserInfo",value:function(){return{name:this._name,info:this._info,avatar:this._avatar}}},{key:"setUserInfo",value:function(t){this._info.textContent=t.about,this._name.textContent=t.name,this._avatar.setAttribute("src",t.avatar)}}])&&E(e.prototype,n),t}();function L(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var C=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._container=e}var e,n;return e=t,(n=[{key:"addItem",value:function(t){this._container.append(t)}},{key:"addMyItem",value:function(t){this._container.prepend(t)}}])&&L(e.prototype,n),t}();function O(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var j=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._url=e.url,this._headers=e.headers}var e,n;return e=t,(n=[{key:"getInitialCards",value:function(){return fetch("".concat(this._url,"cards"),{method:"GET",headers:this._headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}},{key:"getProfile",value:function(){return fetch("".concat(this._url,"users/me"),{method:"GET",headers:this._headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}},{key:"setProfileData",value:function(t,e){return fetch("".concat(this._url,"users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}},{key:"setProfileAvatar",value:function(t){return fetch("".concat(this._url,"users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}},{key:"postCard",value:function(t){return fetch("".concat(this._url,"cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:t.name,link:t.link})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}},{key:"deleteCard",value:function(t){return fetch("".concat(this._url,"cards/").concat(t),{method:"DELETE",headers:this._headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}},{key:"putLike",value:function(t){return fetch("".concat(this._url,"cards/likes/").concat(t),{method:"PUT",headers:this._headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}},{key:"unPutLike",value:function(t){return fetch("".concat(this._url,"cards/likes/").concat(t),{method:"DELETE",headers:this._headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}}])&&O(e.prototype,n),t}();function P(t){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function q(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function R(t,e,n){return(R="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=I(t)););return t}(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function T(t,e){return(T=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function x(t,e){return!e||"object"!==P(e)&&"function"!=typeof e?B(t):e}function B(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function I(t){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var V,D=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&T(t,e)}(c,t);var e,n,o,r,i=(o=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=I(o);if(r){var n=I(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return x(this,t)});function c(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(n=i.call(this,t))._popup=t,n.submitButton=n._popup.querySelector(".popup__save-button"),n.setEventListeners=n.setEventListeners.bind(B(n)),n._id,n._target,n._func=e,n}return e=c,(n=[{key:"open",value:function(t,e){R(I(c.prototype),"open",this).call(this),this._id=t,this._target=e}},{key:"setEventListeners",value:function(){var t=this;R(I(c.prototype),"setEventListeners",this).call(this),this.submitButton.addEventListener("click",(function(){t._func(t._id,t._target),t.submitButton.textContent="Да..."}))}}])&&q(e.prototype,n),c}(c),A=document.querySelector(".profile__avatar"),U=document.querySelector(".button_change-avatar"),N=document.querySelector("#popup-changeavatar"),J=document.querySelector("#avatar-form"),M=document.querySelector("#place-form"),F=document.querySelector(".profile__add-button"),G=document.querySelector(".profile__edit-button"),H=document.querySelector("#popup"),z=document.querySelector(".popup__photo-img"),K=document.querySelector(".popup__photo-name"),Q=document.querySelector("#popup-place"),W=document.querySelector("#popup-photo"),X=document.querySelector("#profile-form"),Y=document.querySelector(".profile__name"),Z=document.querySelector(".profile__text"),$=document.querySelector(".popup__name-input"),tt=(document.querySelector(".popup__place-name-input"),document.querySelector(".popup__info-input")),et=(document.querySelector(".popup__src-input"),document.querySelector("#photocard")),nt=document.querySelector(".photocards"),ot=document.querySelector("#popup-erase"),rt=new j({url:"https://mesto.nomoreparties.co/v1/cohort-20/",headers:{authorization:"791affea-f9d6-450e-956e-cb248107940a","Content-Type":"application/json"}}),it=rt.getProfile(),ct=rt.getInitialCards(),ut=new C(nt),st=new S(W,z,K),at=new w(Y,Z,A),lt=new _(H,(function(t){gt({name:t.first,about:t.second})})),ft=new _(Q,(function(t){var e={name:t.first,link:t.second};rt.postCard(e).then((function(t){ut.addMyItem(mt(t)),ft.submitButton.textContent="Сохранить",ft.close()})).catch((function(t){console.log(t)}))})),pt=new _(N,(function(t){rt.setProfileAvatar(t.second).then((function(t){at.setUserInfo(t),pt.submitButton.textContent="Сохранить",pt.close()})).catch((function(t){console.log(t)}))})),ht=new r(J,n),_t=new r(M,n),dt=new r(X,n),yt=new D(ot,(function(t,e){vt=!0,function(t,e){vt&&rt.deleteCard(t).then((function(){e.parentElement.remove(),yt.submitButton.textContent="Да",vt=!1,yt.close()})).catch((function(t){console.log(t)}))}(t,e)})),vt=!1;function mt(t){return new e(t,V,bt,Et,St,et,rt).createCard()}function bt(t,e,n){t.classList.contains("photocards__likeimg-fill")?(n.unLikeCard(e),t.classList.toggle("photocards__likeimg-fill")):(n.likeCard(e),t.classList.toggle("photocards__likeimg-fill"))}function kt(){var t=at.getUserInfo();$.value=t.name.textContent,tt.value=t.info.textContent}function gt(t){rt.setProfileData(t.name,t.about).then((function(t){at.setUserInfo(t),lt.submitButton.textContent="Сохранить",lt.close()})).catch((function(t){console.log(t)}))}function St(t,e){yt.open(t,e)}function Et(t,e){st.open(t,e)}pt.setEventListeners(),ft.setEventListeners(),lt.setEventListeners(),st.setEventListeners(),yt.setEventListeners(),ct.then((function(t){t.forEach((function(t){ut.addItem(mt(t))}))})).catch((function(t){console.log(t)})),it.then((function(t){gt(t),V=t._id})).catch((function(t){console.log(t)})),_t.enableValidate(),dt.enableValidate(),ht.enableValidate(),U.addEventListener("click",(function(t){t.preventDefault(),kt(),pt.open(),ht.resetValidation()})),G.addEventListener("click",(function(t){t.preventDefault(),kt(),lt.open(),dt.resetValidation()})),F.addEventListener("click",(function(t){t.preventDefault(),ft.open(),_t.resetValidation()}))})();